//// Start copy
const subjectss = [
    {
        "id_to_hoc": "-6458314841699054507",
        "id_mon": "-7680407181690185784",
        "ma_mon": "61FIT4ATI",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "01",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 4,từ 14:30 đến 16:10,16/08/23 đến 22/11/23<hr>Thứ 4,từ 07:20 đến 09:00,23/08/23 đến 29/11/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-8704409564463702758",
        "id_mon": "-7680407181690185784",
        "ma_mon": "61FIT4ATI",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "02",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 4,từ 14:30 đến 16:10,16/08/23 đến 22/11/23<hr>Thứ 4,từ 09:30 đến 11:10,23/08/23 đến 29/11/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-8505019068014488633",
        "id_mon": "-7680407181690185784",
        "ma_mon": "61FIT4ATI",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "03",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 2,từ 14:30 đến 16:10,21/08/23 đến 28/08/23(TH)<hr>Thứ 2,từ 14:30 đến 16:10,11/09/23 đến 04/12/23(TH)<hr>Thứ 4,từ 14:30 đến 16:10,16/08/23 đến 22/11/23",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },{
        "id_to_hoc": "-6024252915205691414",
        "id_mon": "-7680407181690185784",
        "ma_mon": "61FIT4ATI",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "04",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 2,từ 12:20 đến 14:00,21/08/23 đến 28/08/23(TH)<hr>Thứ 2,từ 12:20 đến 14:00,11/09/23 đến 04/12/23(TH)<hr>Thứ 4,từ 14:30 đến 16:10,16/08/23 đến 22/11/23",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },


    {
        "id_to_hoc": "-9015643491567925123",
        "id_mon": "-6595805319696904699",
        "ma_mon": "61FIT4MLA",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "01",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,22/08/23 đến 28/11/23(TH)<hr>Thứ 4,từ 12:20 đến 14:00,16/08/23 đến 22/11/23",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-8433041227611895631",
        "id_mon": "-6595805319696904699",
        "ma_mon": "61FIT4MLA",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "02",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 4,từ 12:20 đến 14:00,16/08/23 đến 22/11/23<hr>Thứ 4,từ 09:30 đến 11:10,23/08/23 đến 29/11/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },{
        "id_to_hoc": "-6311250439886537422",
        "id_mon": "-6595805319696904699",
        "ma_mon": "61FIT4MLA",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "03",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 2,từ 12:20 đến 14:00,21/08/23 đến 28/08/23(TH)<hr>Thứ 2,từ 12:20 đến 14:00,11/09/23 đến 04/12/23(TH)<hr>Thứ 4,từ 12:20 đến 14:00,16/08/23 đến 22/11/23",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },{
        "id_to_hoc": "-8410257973591210369",
        "id_mon": "-6595805319696904699",
        "ma_mon": "61FIT4MLA",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "04",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 2,từ 14:30 đến 16:10,21/08/23 đến 28/08/23(TH)<hr>Thứ 2,từ 14:30 đến 16:10,11/09/23 đến 04/12/23(TH)<hr>Thứ 4,từ 12:20 đến 14:00,16/08/23 đến 22/11/23",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },


    {
        "id_to_hoc": "-4947403865101260326",
        "id_mon": "-5964357857774878518",
        "ma_mon": "61FIT4SPM",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "01",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 30,
        "sl_cp": 30,
        "sl_cl": 0,
        "tkb": "Thứ 7,từ 07:20 đến 09:00,19/08/23 đến 26/08/23<hr>Thứ 7,từ 09:30 đến 11:10,26/08/23 (TH)<hr>Thứ 7,từ 07:20 đến 09:00,09/09/23 đến 02/12/23<hr>Thứ 7,từ 09:30 đến 11:10,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": true,
        "is_dk": false,
        "gc_enable": "Hết sĩ số",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-7230085487588202130",
        "id_mon": "-5964357857774878518",
        "ma_mon": "61FIT4SPM",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "02",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 10,
        "sl_cp": 30,
        "sl_cl": 20,
        "tkb": "Thứ 7,từ 07:20 đến 09:00,19/08/23 đến 26/08/23<hr>Thứ 7,từ 12:20 đến 14:00,26/08/23 (TH)<hr>Thứ 7,từ 07:20 đến 09:00,09/09/23 đến 02/12/23<hr>Thứ 7,từ 12:20 đến 14:00,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": true,
        "hauk": true,
        "is_dk": true,
        "gc_enable": "",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-9108376575250934426",
        "id_mon": "-5964357857774878518",
        "ma_mon": "61FIT4SPM",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "03",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 3,
        "sl_cp": 30,
        "sl_cl": 27,
        "tkb": "Thứ 7,từ 07:20 đến 09:00,19/08/23 đến 26/08/23<hr>Thứ 7,từ 14:30 đến 16:10,26/08/23 (TH)<hr>Thứ 7,từ 07:20 đến 09:00,09/09/23 đến 02/12/23<hr>Thứ 7,từ 14:30 đến 16:10,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": true,
        "hauk": true,
        "is_dk": false,
        "gc_enable": "",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-9113134281110786563",
        "id_mon": "-5964357857774878518",
        "ma_mon": "61FIT4SPM",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2020",
        "to": "04",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 14,
        "sl_cp": 30,
        "sl_cl": 16,
        "tkb": "Thứ 3,từ 17:20 đến 19:00,22/08/23 đến 28/11/23(TH)<hr>Thứ 7,từ 07:20 đến 09:00,19/08/23 đến 26/08/23<hr>Thứ 7,từ 07:20 đến 09:00,09/09/23 đến 02/12/23",
        "is_hl": false,
        "enable": true,
        "hauk": true,
        "is_dk": false,
        "gc_enable": "",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },


    {
        "id_to_hoc": "-6549788773937012380",
        "id_mon": "-5606614407852048028",
        "ma_mon": "61FIT3CGR",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2021",
        "to": "01",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,15/08/23 đến 21/11/23<hr>Thứ 3,từ 12:20 đến 14:00,22/08/23 đến 28/11/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-6701646961097080831",
        "id_mon": "-5606614407852048028",
        "ma_mon": "61FIT3CGR",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2021",
        "to": "02",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,15/08/23 đến 21/11/23<hr>Thứ 3,từ 14:30 đến 16:10,22/08/23 đến 28/11/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-4632107436251126164",
        "id_mon": "-5606614407852048028",
        "ma_mon": "61FIT3CGR",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2021",
        "to": "03",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,15/08/23 đến 21/11/23<hr>Thứ 7,từ 07:20 đến 09:00,26/08/23 (TH)<hr>Thứ 7,từ 07:20 đến 09:00,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-6377401455161641767",
        "id_mon": "-5606614407852048028",
        "ma_mon": "61FIT3CGR",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2021",
        "to": "04",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,15/08/23 đến 21/11/23<hr>Thứ 7,từ 09:30 đến 11:10,26/08/23 (TH)<hr>Thứ 7,từ 09:30 đến 11:10,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    },
    {
        "id_to_hoc": "-5881018912092334553",
        "id_mon": "-5606614407852048028",
        "ma_mon": "61FIT3CGR",
        "ten_mon": "",
        "so_tc": "3",
        "so_tc_so": 3.0,
        "is_vuot": false,
        "nhom_to": "01.2021",
        "to": "05",
        "lop": "*",
        "ds_lop": [
            "*"
        ],
        "is_kdk": false,
        "sl_dk": 0,
        "sl_cp": 30,
        "sl_cl": 30,
        "tkb": "Thứ 3,từ 09:30 đến 11:10,15/08/23 đến 21/11/23<hr>Thứ 7,từ 12:20 đến 14:00,26/08/23 (TH)<hr>Thứ 7,từ 12:20 đến 14:00,09/09/23 đến 09/12/23(TH)",
        "is_hl": false,
        "enable": false,
        "hauk": false,
        "is_dk": false,
        "gc_enable": "Ngoài thời gian cho phép đăng ký",
        "is_rot": false,
        "is_ctdt": true,
        "is_chctdt": true,
        "is_kg_lt": false,
        "thu": 0,
        "tbd": 0,
        "so_tiet": 0,
        "is_kg_huy_kqdk": false
    }
]


// ui element 
const registedSubject = [];
const customModal = document.createElement('dialog');
// customModal.style.width = "70%";
const body = document.querySelector('body');
const closeBtn = document.createElement('button');
const resetBtn = document.createElement('button');
resetBtn.textContent = "Reset";
resetBtn.style.margin = "5px";
resetBtn.addEventListener('click', (e) => resetTable())
customModal.appendChild(resetBtn);
const tableData = document.createElement('table');
tableData.setAttribute('id', 'tbl');
closeBtn.textContent = "Close";
closeBtn.style.margin = "5px";
closeBtn.addEventListener('click', (e) => {
    customModal.close()
})
customModal.appendChild(tableData);
customModal.appendChild(closeBtn);
body.appendChild(customModal);

const tabl = document.getElementById('tbl');
const tHead = document.createElement('thead');
const tBody = document.createElement('tbody');
tabl.setAttribute('border', '1px solid');
tabl.appendChild(tHead);
tabl.appendChild(tBody);
const fieldTitles = ["Môn","Tổ", "Nhóm", "Số lượng", "Còn lại", "TKB", "Lựa chọn"]
const tHeadRow = document.createElement('tr');
tHead.appendChild(tHeadRow);


fieldTitles.forEach(function (field) {
    const tCol = document.createElement('td');
    tCol.innerHTML = field;
    tCol.style.padding = '5px';
    tCol.style.border = "1px solid";
    tHeadRow.appendChild(tCol);
});


// customModal.showModal();
function setupCourseRegistrationModal(data) {
    const fields = ['ma_mon', 'nhom_to', 'to', 'sl_cp', 'sl_cl', 'tkb'];
    for(let i = 0; i < data.length; i++) {
        const sbj = data[i];
        const tRow = document.createElement('tr');
        tBody.appendChild(tRow);
        fields.forEach(function (field) {
            const tCol = document.createElement('td');
            tCol.innerHTML = sbj[field];
            tCol.style.padding = '5px';
            tCol.style.border = "1px solid"
            tRow.appendChild(tCol);
        })
        const regisBtn = document.createElement('button');
        regisBtn.textContent = "Register";
        // regisBtn.disabled = !sbj.enable || !sbj.is_dk;
        regisBtn.addEventListener('click', (e) => {
            submitData(e, sbj.id_to_hoc, sbj.id_mon);
        })
        if (registedSubject.includes(sbj.id_to_hoc)) 
            regisBtn.disabled = true;
        const cancelBtn = document.createElement('button');
        cancelBtn.textContent = "Cancel";
        cancelBtn.addEventListener('click', () => {
            cancel(regisBtn, sbj.id_to_hoc)
        })
        const tCol = document.createElement('td');
        tCol.appendChild(cancelBtn);
        tCol.appendChild(regisBtn);
        tRow.appendChild(tCol); 
    }
}

/*** Get data api */
let dsdk;
const index = [930, 1107, 1233, 1322, 932, 1109, 1235, 1323, 933, 1110, 1236, 1324, 943, 1116, 1238, 1325, 1385, 984, 1141, 1256];
const token = JSON.parse(sessionStorage.getItem("CURRENT_USER")).access_token;
function getSubject() {
    setupCourseRegistrationModal(subjectss);
}

function resetTable (data) {
    tBody.innerHTML = "";
    getSubject();
}



function submitData(e, idToHoc, idMon) {
    const structure = {
        filter : {
            id_to_hoc :idToHoc,
            is_checked : true,
            sv_nganh: 1
        }
    }
    const object2 = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ` + token, 
        },
        body: JSON.stringify(structure)
    }
    fetch('http://qldt.hanu.vn/api/dkmh/w-xulydkmhsinhvien', object2)
    .then(res => res.json()
    .then(data => {
        console.log(data.data)
        if (data.data.is_thanh_cong) {
            e.target.disabled = true;
            registedSubject.push(idToHoc);
        }
    }))  
}

function cancel(smbtn, idToHoc) {
    const structure = {
        filter : {
            id_to_hoc :idToHoc,
            is_checked : false,
            sv_nganh: 1
        }
    }
    console.log(smbtn);
    const object2 = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ` + token, 
        },
        body: JSON.stringify(structure)
    }
    fetch('http://qldt.hanu.vn/api/dkmh/w-xulydkmhsinhvien', object2)
    .then(res => res.json()
    .then(data => {
        if (data.data.is_thanh_cong) {
            smbtn.disabled = false;
            var index = registedSubject.indexOf(idToHoc);
            if (index !== -1) {
                registedSubject.splice(index, 1);
            }
        }
    })) 
}
customModal.showModal();
//// copy to this line
